2000-11-15  Jacob "Ulysses" Berkman  <jacob@helixcode.com>

	* gnome-login-check.c (main): change the error message to
	reference the patch which fixes this.

2000-11-03  Jacob "Ulysses" Berkman  <jacob@helixcode.com>

	* gnome-login-check.c (main): only do the login check on Solaris

Thu Nov 02 01:58:03 2000  George Lebl <jirka@5z.com>

	* manager.c (update_save_state):  When concatenating, copy the
	  list.  Also free the old list since we used a copy to concat.
	  this is because the send_message is mucking around inside the
	  list which really confuses things unless it works on it's own
	  private copy.  This pases with glib compiled with glists really
	  being freed.

2000-10-31  Jacob "Ulysses" Berkman  <jacob@helixcode.com>

	* gnome-login-check.c (main): patch from KUSANO Takayuki
	<AE5T-KSN@asahi-net.or.jp> to fix i18n

2000-10-30  Jacob "Ulysses" Berkman  <jacob@helixcode.com>
	        
	* gnome-libice-check.c (main): seg fault if libICE is broken

        * gnome-login-check.c (main): add a test for broken libICE on solaris

Thu Jun 29 02:39:04 2000  Tim Janik  <timj@gtk.org>

	* main.c (main): if the session loaded is empty (probably because
	the session name is a new one), fallback to failsafe and reload,
	so the clients of the default session are present.

Sat May 27 12:33:19 2000  George Lebl <jirka@5z.com>

	* main.c, manager.c, session-properties.c, gsm-protocol.c, ice.c:
          Fix compile warnings

	* logout.c: Dialog running can return -1 as well.  This is fixes
	  a compile warning and bug #12130

2000-05-18  Mark Crichton <crichton@gimp.org>

        * session-properties.c: Made it use a better default visual.
        This is for the proposed changes in gdk_imlib.

2000-05-14  Karl Eichwalder  <ke@suse.de>

	* session.desktop: Improve de.

2000-05-11  Miguel de Icaza  <miguel@helixcode.com>

	* ice.c (initialize_ice): By default, do not listen to TCP
	connections.

Mon May 08 20:18:32 2000  George Lebl <jirka@5z.com>

	* splash.c (destroy_dialog): run gnome-hint with --startup-session

2000-05-06  Jacob Berkman  <jacob@helixcode.com>

	* default.in: move gmc to priority 40 so that it shows up in the
	splash screen

2000-05-05  Jacob Berkman  <jacob@helixcode.com>

	* logout.c (display_gui): open up (the panel's) help
	(display_gui): add a help button

2000-05-03  Michael Meeks  <michael@helixcode.com>

	* command.c (command): s/strcasecmp/g_strcasecmp/

Tue May 02 23:42:25 2000  George Lebl <jirka@5z.com>

	* ice.c: since the code using IceListenForWellKnownConnections is
	  comment it out, comment out the init_well_known_connections
	  function, this will make it at least for now compile on non
	  Linux or IRIX systems.

2000-05-03  Yukihiro Nakai <nakai@gnome.gr.jp>

	* save-session.desktop: Add Japanese translation.

2000-04-28  John Harper  <john@dcs.warwick.ac.uk>

	* gnome-wm: updated for sawmill -> sawfish name change

2000-04-20  Jacob Berkman  <jacob@helixcode.com>

	* session-properties.c (help): May as well make the help button
	actually do something

2000-01-03  Miguel de Icaza  <miguel@gnu.org>

	* gnome-session.1: remove options that are not actually
	implemented (Thank to Owen for reviewing the documentation)

2000-04-15  Karl EICHWALDER  <ke@suse.de>

	* save-session.desktop: Add de, lt, ru and sv -- entries were gone
	with revision 1.14 (fi).

2000-04-14  Fatih Demir	<kabalak@gmx.net>

	* session.desktop & save-session.desktop :
		added [tr] ...

2000-04-12  Karl EICHWALDER  <ke@suse.de>

	* save-session.desktop (Name): Add `de'.
	* session.desktop (Comment): Improve `de'.

2000-04-04  Jacob Berkman  <jacob@helixcode.com>

	* save-session.desktop (Icon): use mc's floppy icon

	* ice.c (initialize_ice): enable TCP for now, since the
	non-TCP is very broken here.

	* save-session.1: document --gui

2000-04-03  Jacob Berkman  <jacob@helixcode.com>

	* ice.c (init_well_known_connections): pass &socket, not socket

2000-04-03  Miguel de Icaza  <miguel@helixcode.com>

	* ice.c (init_well_known_connections): Attempt to allocate a
	number of ports, instead of failing on the first one

2000-01-03  Miguel de Icaza  <miguel@gnu.org>

	* gnome-session.1: remove options that are not actually
	implemented (Thank to Owen for reviewing the documentation)

2000-03-31  Jacob Berkman  <jacob@helixcode.com>

	* ice.c (initialize_ice): 

	* main.c (main): we need to gnomelib_init() before
	initialize_ice() due to the fact that gnome-libs is
	broken, and we need to gnome_config() in initialize_ice()

2000-04-03  Alastair McKinstry <mckinstry@computer.org>

	* gsm.desktop: Add Irish (Gaelic) translation.

2000-03-30  Jacob Berkman  <jacob@helixcode.com>

	* splash.c (hint): remove some more debugging stuff

	* default.in: bell-capplet is no more

2000-02-28  Jacob Berkman  <jacob@helixcode.com>

	* save.c (read_one_client): fix possible seg fault (patch from
	Peter Runestig <peter@runestig.com>)

2000-02-27  Jacob Berkman  <jacob@helixcode.com>

	* splash.c (window_realize): add some better window hints

	* default.in (num_clients): remove gnome-hint from the session

	* splash.c (stop_splash): add a 2 second delay after we get called
	before destroying the dialog.
	(stop_splash): run gnome-hint if splash screen is disabled
	(splash_cleanup): run gnome-hint if splash screen is enabled

2000-02-20  Jacob Berkman  <jacob@helixcode.com>

	* Makefile.am (desktop_DATA): put in the Session directory

2000-02-18  Timur Bakeyev  <timur@gnu.org>

	* gnome-wm: Replace call to 'which' with simple, home-made script.
	Unfortunately, some vendors are broken-mind, and which returns 0 and
	error string on stdout instead of just indication of an error...
	
	* Add qvwm as a bit better WM that fvwm:.

2000-02-13  Jacob Berkman  <jacob@helixcode.com>

	* gsm-protocol.c (dispatch_event): remove some debugging stuff

2000-02-11  Jacob Berkman  <jacob@helixcode.com>

	* splash.c (update_splash): fix tyops

2000-02-10  Matthias Warkus  <mawa@iname.com>

	* session.desktop: Use gnome-session.png.

2000-02-05  Jacob Berkman  <jacob@helixcode.com>

	* save-session.desktop (Exec): pass --gui

	* save-session.c: pop up some spiffy dialogs instead of
	printing to the console if --gui was passed

2000-01-30  Jacob Berkman  <jacob@helixcode.com>

	* session.desktop (Name): undo last change

2000-01-27  Jacob Berkman  <jacob@helixcode.com>

	* Makefile.am (pixmap_DATA): move gnome-splash here

	* splash.c (start_splash): look in pixmaps/splash/ for the splash
	screen

2000-01-24  Jacob Berkman  <jacob@helixcode.com>

	* session-properties.c (sess_select_row): don't connect the signal

2000-01-23  Jacob Berkman  <jacob@helixcode.com>

	* session-properties.c (create_table): don't wait for the 
	initialized signal
	(initialized_cb): disable this code for now
	(main): show the app here

2000-01-11  Anders Carlsson  <andersca@gnu.org>

	* splash.c (start_splash): Changed the splash window to a 
	GTK_WINDOW_POPUP one and put everything in a GtkFrame.

Mon Jan 10 17:26:50 2000  George Lebl <jirka@5z.com>

	* gnome-wm: Take two arguments, --default-wm and --sm-client-id
	  and run a windowmanager with the client id translated into an
	  appropriate option for any given windowmanager.

	* default.in: add the --sm-client-id option and always call gnome-wm
	  script and pass the @WINDOW_MANAGER@ configure variable as the
	  --default-wm

	* gnome-wm.1: update for the two options and the new behaviour and
	  fix a couple spelling errors

2000-01-08  Jacob Berkman  <jacob@helixcode.com>

	* splash.c: remove debuggin' output

2000-01-06  Jacob Berkman  <jacob@helixcode.com>

	* Makefile.am (default_DATA): fix tyop from previous
	commit

Mon Jan 03 22:19:47 2000  George Lebl <jirka@5z.com>

	* splash.c: put the splashscreen into the WIN_LAYER_ABOVEDOCK
	  layer to put it above anything.  Makes it look much better
	  if the splashscreen stays around long enough for the hints
	  to come up.

2000-01-01  Miguel de Icaza  <miguel@gnu.org>

	* save-session.1: New man page.
	
	* gnome-session.1.in: New man page.

	* default.session.5.in: New man page.

	* gnome-wm.1: Added gnome-wm man page

	* gnome-login-check.c (main): Made indentation consistent.

1999-12-29  Jacob Berkman  <jberkman@andrew.cmu.edu>

	* main.c:
	* manager.[ch]: support the splash screen stuff

	* splash.[ch]: splash dialog which indicates progress up
	to level 49

1999-12-10  Jacob Berkman  <jberkman@andrew.cmu.edu>

	* default.in: don't pass -clientId as this really screws
	things up for people using sawmill or wmaker.  We should
	probably find a better way of doing this

1999-11-02  Elliot Lee  <sopwith@redhat.com>

	* *.c: Eliminate miscellaneous warnings found by OSPC, including the bugfix for property name comparison.
	* gnome-login-check.c: Check ownership of /tmp/orbit-username for sanity's sake.

1999-10-25  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* logout.c, manager.c, gnome-login-check.c: Include config.h.
	Otherwise messages are not translated.

1999-10-22  Jacob Berkman  <jberkman@andrew.cmu.edu>

	* gnome-wm: add sawmill to the front of the list,
	since people who have sawmill probably want to use it

1999-10-21  Jacob Berkman  <jberkman@andrew.cmu.edu>

	* manager.h: use a signed int for num_sockets.

1999-10-20  Martin Norbäck  <norpan@bigfoot.com>

	* session.desktop: Added Swedish entry

Sat Oct 02 21:29:32 1999  George Lebl  <jirka@5z.com>

	* default.in: add gnome-hint to the default session

1999-09-22  Jonathan Blandford  <jrb@redhat.com>

	* logout.c (refresh_screen): let the logout button get the new
	theme too.

1999-08-17  Jacob Berkman  <jberkman@andrew.cmu.edu>

	* gnome-wm: add twm as a last-chance-best-effort try
	for a window manager

	<Myth> twm is better than nothing at all	

1999-08-01  Tom Tromey  <tromey@cygnus.com>

	* logout.c (display_gui): Call set_trash_mode.
	(save): Removed.

	* logout.c: Reverted previous patch.  It turns out that saves can
	happen at "random" times, so this change would have caused user
	confusion and not much more.

1999-08-01  Jacob Berkman  <jberkman@andrew.cmu.edu>

	* logout.c (display_gui): always display the "save current setup"
	check box, but uncheck it if we are trashing the session

1999-07-31  Tom Tromey  <tromey@cygnus.com>

	* logout.c (display_gui): Added `ask next time' button.

	* manager.c (process_save_request): Cancel a shutdown cancelled by
	user.

1999-07-30  Tom Tromey  <tromey@cygnus.com>

	* gnome-login-check.c (timeout): Removed unused variable.
	(check_for_dns): Now static.

	* manager.h (set_logout_command): Declare.
	(maybe_display_gui): Declare.
	* command.c (set_logout_command): New function.
	(prop_dup): Made `i' signed.
	* manager.c (process_save_request): Query user on interactive
	shutdown.
	(update_save_state): Made `runlevel' unsigned.

	* logout.c: New file (modified from patch by Owen Taylor).

1999-07-30  Owen Taylor  <otaylor@redhat.com>

	* Makefile.am (noinst_PROGRAMS): Removed.
	(bin_PROGRAMS): Include session-properties again.  Added
	gnome-login-check.
	(gnome_login_check_SOURCES): New macro.
	* command.c (logout_command_argc, logout_command_argv): New
	globals.
	(execute_logout): New function.
	* gnome-login-check.c: New file.
	* main.c (options): Removed --trash-saves.
	(main): Set `trashing' based on user option.  Call
	execute_logout.
	* manager.h (MANUAL_CONFIG_PREFIX): New macro.
	(GSM_OPTION_CONFIG_PREFIX): Likewise.
	(TRASH_MODE_KEY, TRASH_MODE_DEFAULT): Likewise.
	(execute_logout): Declare.
	(set_trash_mode): Likewise.
	* save.c (saved_session_name): New global.
	(set_session_name): Set it.
	(set_trash_mode): New function.
	(read_session): Read manual client list from config file.
	* session-properties.c (create_table): Omit "Program" field.

1999-07-16  Tom Tromey  <tromey@cygnus.com>

	Warning cleanups:
	* gsm-protocol.c (gsm_session_destroy): Actually NULL
	live_session.
	(gsm_session_destroy): Removed unused variables.
	(gsm_client_destroy): Likewise.
	(gsm_protocol_destroy): Likewise.
	(dispatch_event): Likewise.
	* gsm-client-row.c (gsm_client_row_add): Removed unused variable.
	(gsm_client_row_remove): Likewise.
	* gsm-client-editor.c (gsm_client_editor_class_init): Removed
	unused variable.
	(gsm_client_editor_new): Likewise.
	* gsm-client-list.c (gsm_client_list_class_init): Removed unused
	variable.
	(gsm_client_list_new): Likewise.
	* session-properties.c (create_table): Removed unused variable.
	(create_buttons): Likewise.
	* remote.c (remote_start): Removed unused variable.
	* save.c (read_session): Removed unused variable.
	* main.c (main): Removed unused variable.
	* ice.c (initialize_ice): Removed unused variable.
	* manager.c (run_command): Removed unused variables.
	(remove_client): Actually traverse linked list.
	(find_client_by_connection): Removed unused function.

Wed Jun 16 09:28:48 1999  Owen Taylor  <otaylor@redhat.com>

	* manager.c (reincarnate_client): Account for the
	fact that a client that has not yet had a handle
	assigned to it may be restarted if it dies during
	initialization. (Fixes problem where control-C'ing
	gmc while it was waiting for the metadata lock
	would kill gnome-session)

	Split some common code off into a separate function. 

1999-07-15  Tom Tromey  <tromey@cygnus.com>

	* ice.c (initialize_ice): Save umask while calling
	IceListenForConnections.  From Roberto Zunino
	<zunino@cli.di.unipi.it>.

	* session.h (DEFAULT_PRIORITY): New macro.
	* save.c (read_one_client): Use DEFAULT_PRIORITY.
	* manager.c (new_client): Use DEFAULT_PRIORITY.
	* gsm-protocol.c (gsm_client_object_init): Use DEFAULT_PRIORITY.
	* command.c (command): Use DEFAULT_PRIORITY.

	* prop.c (free_vector): Only free `argv' if not NULL.

	* ice.c (write_authfile): Don't remove entries from list.  Don't
	free entries.
	(auth_entries): New global.
	(initialize_ice): Set it.

	* manager.h (remote_start, auth_entries): Declare.
	* Makefile.am (gnome_session_SOURCES): Added remote.c.
	* remote.c: New file; modified from X11R6.3 xsm.
	* manager.c (run_command): Correctly determine when `envc' is
	even.  Always call free_vector on environment list.  Remote start
	client if appropriate.

	* session.h (GsmRestartService): New macro.
	* save.c (properties): Added _XC_RestartService entry.

	* auth.h: Removed.
	* auth.c: Removed.

1999-07-05  David Kaelbling <drk@sgi.com>

	* manager.c: time_t is not always a long as it was assumed.  ON
	64-mahcines it might be sometehing else.

1999-05-22  Felix Bellaby  <felix@pooh.u-net.com> 

	* ice.c (initialize_ice): incorporate Martin's change of 1999-05-20
	into initialize_ice so that gsm only locks the authority file once.
	(startup_clean_ice): redundant and removed.
	
1999-05-20  Martin Baulig  <martin@home-of-linux.org>

	* ice.c (startup_clean_ice): New static function. After an unclean
	shutdown clean_ice () may not have been called the last time so there
	may be stale records left in the ICEauthority file which we need to
	remove first.

1999-04-14  Matthias Warkus  <mawa@iname.com>

	* session.desktop: Added [de] translations; methinks this was a
	silly thing since the file looked kinda obsolete...

1999-03-25  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* Makefile.am: Put gnome-wm in EXTRA_DIST.

1999-03-24  Felix Bellaby  <felix@pooh.u-net.com> 

	* manager.c (purge): put all clients that fail to register from
	default.session into the purge_retain_list so they are restarted.
	
1999-03-23  Martin Baulig  <martin@home-of-linux.org>

	* gnome-wm: New file. This is a short shell script that starts
	the WM for us. The user can set a WINDOW_MANAGER environment
	variable in his ~/.xsession to set his prefered WM; otherwise
	it looks which WMs are installed and chooses a good one. To tell
	the wm-properties-capplet which WM we're running, this will be
	writtin into `default_wm/Default/WM'.

	* Makefile.am: Added explicit dependency to create default.session
	and default.wm if config.status has changed.

1999-03-22  Felix Bellaby  <felix@pooh.u-net.com> 

	* manager.c (no_response_warning): remove clients on failure to 
	respond to XSMP commands with user confirmation via separate GUI.
 	(remove_client): add capacity to remove unresponsive clients.
	* session.h, command.c, save.c: add confirmations to warning dialogs.
	* main.c: add warn-delay option.
	* ice.c (accept_connection): accept during shutdown to return error.
	* manager.h: update to match above changes.
	* default.in: new session containing a client which shows warnings.
	* session-properties.c: support a warning only mode.
	* gsm-client-row.c: relocate warning handler code into parent:
	* gsm-protocol.c, gsm-protocol.h: obtain user confirmations.

1999-03-19  Felix Bellaby  <felix@pooh.u-net.com> 

	* main.c (main): extra command line options.
	* save.c (set_session_name): set name to TRASH_SESSION on trash-saves.
	(read_session): ignore CONFIG_PREFIX on failsafe.
	(write_session): do not write the CHOOSER_SESSION.
	* session.h, comand.c(command): minor protocol refinements. 
	* manager.h: add items from session.h that are private to gnome-session
	* default.in: add specification of the chooser command/session.
	* gsm-client-*: signal end of session startup. 
	
1999-03-18  Felix Bellaby  <felix@pooh.u-net.com> 

	* save.c (read_one_client): never use glib to alloc client->id. 
	* manager.c (free_client): use free to free client->id because libSM
	allocs client->id using malloc.
	(remove_client): also remove clients which have yet to be started.
	(purge_client): put GsmAddClient clients into purge_retain_list.
	* ice.c (initialize_ice): do not free value passed to putenv.
	* Makefile.am: change files used in build as follows...
	* gsm-column.*: no longer used.
	* gsm-client-editor.*: alternative means of editing clients.
	* gsm-*: change GUI details and add session chooser stuff.
	* session-properties.c: updated for changs in GUI.

1999-03-17  Nuno Ferreira  <nmrf@rnl.ist.utl.pt>

	* manager.c (free_client): use g_free() to free client->id instead
	of free(). It is a value returned by gnome_config_get_string().

Wed Mar 17 11:48:11 1999  Owen Taylor  <otaylor@redhat.com>

	* Makefile.am (default_DATA): Install default.session
	in $datadir/gnome, where it is being looked for now.
	
1999-03-12 Felix Bellaby  <felix@pooh.u-net.com> 

	* session.h: protocol extension specs.
	* command.c: contains the code implementing the server side of
	the gnome-session protocol extensions.
	* manager.*, save.c.: accomodate protocol extensions.
	* ice.c: remove dependency on iceauth binary.
	* main.c: fix SIGPIPE handling.
	* gsm-client-*, gsm-column.*: the client list widget code.
	* gsm-protocol.*: gtk interface to protocol extensions.
	* session-properties.c: use client list widget.
	* Makefile.am: build the new code.

1999-03-02  Martin Baulig  <martin@home-of-linux.org>

	* default.wm.in: New file. We install this in $(datadir) and
	read it in the wm-properties capplet to get the default WM.

1999-02-25 Michael Fulbright <drmike@redhat.com>

	* Makefile.am: moved to Settings group

1999-02-16 Felix Bellaby  <felix@pooh.u-net.com>

	* manager.c (start_client): drop non-session aware clients from memory.
	* save.c (delete_session): read non-session aware clients from config. 
	(write_session): write non-session aware clients back into config.
	(set_session_name): record name of current session in config.
	(read_session): use name of last session run as first fallback.
	* manager.h: move DEFAULT_SESSION to session.h
	* session.h: add the additional info needed by session-properties.
	These changes allow the session-properties capplet to control which
	non-session aware clients are in the session by editing the config.
	* session-properties.c: fixed but rendered obsolete by capplet.
	
1999-02-14  Owen Taylor  <otaylor@redhat.com>

	* manager.c (close_connection): Removed C++ comment.

1999-02-14 Felix Bellaby  <felix@pooh.u-net.com>

	* manager.c (io_error_handler): NEVER close connections outside
	gnome-ice.c because the ICElibs sometimes go haywire if you close 
	a connection inside the IceProcessMessages call!
	(kill_client_connection): redundant and removed.
	
1999-02-14 Felix Bellaby  <felix@pooh.u-net.com>

	* manager.c (io_error_handler): do not close connections which
	have no matching clients as gnome-ice.c does this for us.
	
1999-02-12 Felix Bellaby  <felix@pooh.u-net.com>

	* save.c (write_session): write details of clients in the purged_list.
	(delete_session): do not call discard commands on purged_list clients.
	(read_one_client): reallocate g_malloc'd strings as malloc'd strings
 	to avoid potential seg faults when they are free'd.
	* manager.c (update_save_state): clear the purged_list on shutdown so
	that any remaining purged clients are discarded.

1999-02-11 Felix Bellaby  <felix@pooh.u-net.com>
	* save.c: Replace "Priority with "_GSM_Priority" throughout.
	(write_session): write details of clients in the pending_list.
	* manager.c (close_connection): use start_client on respawned clients
 	so that they are purged when they fail to connect.

1999-02-10 Felix Bellaby  <felix@pooh.u-net.com>

	* save.c (delete_session): do not call discard commands on clients
	in the pending_list.
	* manager.c: export pending_list to save.c

1999-02-09 Felix Bellaby  <felix@pooh.u-net.com>

	* manager.c (close_connection): restart RestartImmediately clients
	unless they have failed 10 times in last 2 minutes.
	* save.c (delete_session): use free_client to free ALL client memory.
	* manager.h: export free_client and expand Client struct.
	
1999-02-06  Changwoo Ryu  <cwryu@adam.kaist.ac.kr>

	* gsm.desktop: Updated Korean translation.

1999-01-28 Felix Bellaby  <felix@pooh.u-net.com>

	* default.in: added esd to start up.
	
1999-01-22 Felix Bellaby  <felix@pooh.u-net.com>

	* manager.h, manager.c (load_session) : queue session starts.
	(process_load_request): initialise load bas on priority ordering.
	(purge): clear slow clients from list of awaited registrations.
	(start_client) support non-session aware clients as well.
	(register_client): maximise retention of previous client ids.
	(update_save_state): startup clients in run level order.
	* save.c (unlock_session, set_session_name) skeleton for name locking.
	* main.c (main): new option to set purge-delay during start up.
	* default.in (accept_connection): new format including runlevels.
	* ice.c (accept_connection): do not close connection on an error
	as the gtk_main_loop does this now inside gnome-ice.c.
	* save-session.c (main): wait until request is acknowledged before
	dying because gnome-session no longer honours requests from zombies.
	
1999-01-21  Carsten Schaar  <nhadcasc@fs-maphy.uni-hannover.de>

	* ice.c (initialize_ice): Removed the 'free' call to the argument
 	of 'putenv', because this breaks the setting of the environment
 	variable at least on my libc5 system.

Tue Jan 19 Felix Bellaby  <felix@pooh.u-net.com>

	* manager.c (kill_client_connection): close protocol cleanly.
	(run_command): run a command for a live client.
	(start_client): convenience function.
	(register_client): carry forward properties on restarted clients
	and send SaveYourselfs to new ones to get their properties.
	(interact_request): allow multiple requests per client and dispatch
	them in order, separating requests for each client.
	(interact_done): wait for SaveDones following a ShutdownCancel to
	avoid confusing one session save with another.
	(process_save_request): process a queued save request.
	(update_save_state): less cryptic replacement for check_session_end
	which does not close connections (as this often kills clients).
	(display_reasons): warning dialog.
	(close_connection): handle RestartImmediately & close cleanly.
	(new_client): refuse connections during shutdown with reason.
	(io_error_handler): display warning.

	* save.c (properties): save SmRestartStyleHint and SmProgram.
	(read_client): translates config file to SmProperties.
	(read_clients): recover full client details from config section.
	(read_session): clone merged session if one is already running
	(delete_session): pulled all the discard code together.

Tue Jan 12 Felix Bellaby  <felix@pooh.u-net.com>

	* manager.c (send_message): Fixed bug patched over by Jay.

Mon Dec 21 Jay Painter <jpaint@serv.net>

	* manager.c (send_message): I don't know what it was suppose to do,
	but now at least it sends messages correctly.  Felix needs to
	look at this.

Mon Dec 14 

	* manager.c (save_yourself_p2_request): only accept one such request
	per client and check if ready to send the Save Yourself P2 messages.
	
Fri Dec 11 Felix Bellaby  <felix@pooh.u-net.com>

	* manager.c (send_message): protect against io errors.
	* manager.c (save_session): protect against io errors.
	* manager.c (check_session_end): protect against io errors.
	* manager.c (interact_done): cancel shutdown when a shutdown cancel
	is sent. Ignore cancels when not shutting down.
	* manager.c (save_yourself_done): do nothing if a shutdown cancelled
	has already been sent.
	
Thu Dec 10 Felix Bellaby  <felix@pooh.u-net.com>

	* save.c (run_commands): fix broken logic on last change.
	
Thu Dec 10 Felix Bellaby  <felix@pooh.u-net.com>

	* save.c (run_commands): fix some memory leaks.
	* save.c (run_string_commands): alternate version of above for
	backwards compatibility with xsm string format discard commands.
	* save.c (delete_session): run string format discard commands.
	* save.c (write_one_client): added support for saving string 
	format discard commands.
	
Tue Dec 7 Felix Bellaby  <felix@pooh.u-net.com>

	* save.c (run_commands): call discard commands on clients that are
	still in the session IF they have changed their discard commands.
	[ partial reversion of change on Nov 28 ] 
	* manager.c (check_session_end): write all running SmRestartIfRunning 
	clients even when the Save Yourself only covered a single client.
	
Sat Dec 5 Felix Bellaby  <felix@pooh.u-net.com>

	* manager.c (save_yourself_request): fix g_assert.
	
1998-11-29  Herbert Valerio Riedel  <hvr@hvrlab.ml.org>

	* session-properties.c (program_remove_cb): added one GPOINTER_TO_INT

	* manager.[ch] (find_client_by_id): added const to arguments

	* prop.c: added #include <string.h> for memcpy-prototype 

Sat Nov 28 Felix Bellaby  <felix@pooh.u-net.com>

	* prop.c (find_string_property): fixed problem that created need
	for "static" patch reverted on Nov 25.
	* save.c (delete_session): do not call discard command on clients 
	that are still in the session.
	* save.c (run_commands): do not call commands on clients in
 	either of two lists.
	* manager.h, manager.c (find_client_by_id): now exported. 

1998-11-27  Jay Painter <jpaint@serv.net>

	* session-properties.c: big UI cleanup in preperation for
	moving it into the Gnome Control Center.

1998-11-25  Tom Tromey  <tromey@cygnus.com>

	* save.c (write_one_client): Reverted `static' change of Nov 11.

1998-11-24  Martin Baulig  <martin@home-of-linux.org>

	* session-properties.c (setup): Put the GtkCList into a
	GtkScrolledWindow and use gtk_scrolled_window_set_policy ()
	if using Gtk 1.1.4.

	* session-properties.c (setup): Set the GtkCList in multiple
	selection mode to fix this fixme.

Wed Nov 11 Felix Bellaby  <felix@pooh.u-net.com>

	* save.c (write_one_client) change argvs to static variable -
	temporary fix until real reason for stack corruption is known.

Fri Nov 6 Felix Bellaby  <felix@pooh.u-net.com>

	* save-session.c (options) added missing val item from struct so
 	that save session does not zap session every time.

Sun Aug 16 17:47:00 1998  Tom Tromey  <tromey@cygnus.com>

	* main.c (main): Call clean_ice().
	(options): New array.
	(debugging): New global.
	(parse_an_arg): Recognize --debug.
	(main): Handle debugging case.
	* auth.h: Use real function prototypes.
	* auth.c: Include auth.h and libgnome/libgnome.h.
	(SetAuthentication): Put .xsm files into ~/.gnome/.

Thu Jul 23 21:50:33 1998  Tom Tromey  <tromey@cygnus.com>

	* session-properties.c (session_die): New function.
	(session_save): New function.
	(struct info): Added `argv0' element.
	(setup): Initialize argv0 element of info.  Return info
	structure.
	(options): New structure.
	(parse_an_arg): New function.
	(geometry): New global.
	(parser): New global.
	(main): Handle session management and argument parsing.

Wed Jul 22 23:11:47 1998  Tom Tromey  <tromey@cygnus.com>

	* session-properties.c (setup): Use GNOME_PAD and
	GNOME_PAD_SMALL.

1998-07-23  Nuno Ferreira  <nmrf@rnl.ist.utl.pt>

	* session.desktop: Added Portuguese translation. 

Tue Jul 21 10:25:55 1998  Tom Tromey  <tromey@cygnus.com>

	* session-properties.c (setup): Connect to "activate" signal on
	entry.  Disable "Delete" button initially.  Connect to "clicked"
	signal on button.
	(entry_ok): New function.
	(remove_items): New function.
	(struct info): New structure.

	* save.c (run_default_session): Use run_preloads to run default
	session.

	* Makefile.am (EXTRA_DIST): Added default.in.
	(data_DATA): New macro.
	(default.session): New target.
	(INCLUDES): Define DEFAULTDIR.
	* default.in: New file.

	* session-properties.c (apply_properties): Use PRELOAD_COUNT_KEY.
	(fill_clist): Likewise.

	* save.c (session_loaded): New global.
	(run_preloads): New function.
	(num_preloads): New function.
	(read_session): Call run_preloads.

	* save.c: Include "session.h".
	* session-properties.c: Include "session.h".
	* Makefile.am (gnome_session_SOURCES): Added session.h.
	(session_properties_SOURCES): Likewise.
	* session.h: New file.

	* session-properties.c (setup): Set scrollbar policy on clist.
	Left align label above clist.
	(apply_properties): Synchronize config.
	(PRELOAD_PREFIX): New define.
	(apply_properties): Use it.
	(fill_clist): New function.
	(setup): Call it.

Sun Jul 19 16:31:51 1998  Tom Tromey  <tromey@cygnus.com>

	* session.desktop: New file.
	* Makefile.am (sysdir): New macro.
	(sys_DATA): Likewise.
	(EXTRA_DIST): Likewise.

	* Makefile.am (bin_PROGRAMS): Added session-properties.
	(session_properties_SOURCES): New macro.
	* session-properties.c: New file.

	* manager.c (save_yourself_request): Handle single-client saves.

	Reverted most changes from July 7.
	* manager.c (old_sess): Removed.
	(restart_session): Removed.
	(save_ps): Removed.
	(saving_ps): Removed.
	* save.c (get_session_name): Removed.
	* manager.h (get_session_name): Removed.

Thu Jul 16 18:10:26 1998  Tom Tromey  <tromey@cygnus.com>

	* save.c (run_default_session): Run gnome-smproxy, not smproxy.

mar jul  7 09:56:07 ART 1998  Horacio J. Peña <horape@compendium.com.ar>

	* manager.c: added support for saving state
	of only one process and for restarting sessions. (it's ugly)
		New global variables saving_ps & old_sess.
		save_yourself_request: added a bunch of code to check for
		the "new" services.
		check_session_end: removed !live_list check (Tom, is it ok?)
		check_session_end: added support for saving_ps & old_sess.
		New functions: save_ps & restart_session.
	* manager.h: Added prototipe for get_session_name.
	* save.c: Added get_session_name.

Sun Jul  5 18:16:00 1998  Tom Tromey  <tromey@cygnus.com>

	* main.c (main): Set the DISPLAY environment variable.
	* save.c (properties): Added SmEnvironment.
	(run_commands): Look up environment and pass to exec.

Sat Jun 13 20:54:05 1998  Tom Tromey  <tromey@cygnus.com>

	Fixed all -Wall warnings:
	* auth.c: Include <stdlib.h>, <sys/stat.h>, <unistd.h>.
	* save-session.c: Include libgnomeui.h, not gnome-client.h.
	(main): Removed unused variable.
	* save.c (write_one_client): Removed unused variable.
	(run_commands): Likewise.
	(delete_session): Likewise.
	* main.c: Include libgnomeui.h, not gnome-client.h.
	* ice.c: Include <gtk/gtk.h>, <stdlib.h>.
	* manager.c: Include <stdlib.h>, <libgnome/libgnome.h>,
	<gtk/gtk.h>.

Sat Jun  6 02:09:49 1998  Tom Tromey  <tromey@cygnus.com>

	* save.c (read_session): If no clients in saved session, load
	default session.

	* manager.c (run_shutdown_commands): New function.
	(check_session_end): Call it.

1998-06-06  Carsten Schaar  <nhadcasc@fs-maphy.uni-hannover.de>

	* save-session.c (main): Replaced 'gnome_client_new_default' with
 	'gnome_master_client'.

	* main.c: Included 'libgnome/gnome-client.h'.
	(main): Added call to 'gnome_client_disable_master_connection'
 	because otherwise 'gnome-session' tries to connect to itself.

Sat May 16 00:47:11 1998  Tom Tromey  <tromey@cygnus.com>

	* Makefile.am (gnome_session_SOURCES): Removed exec.c.
	* manager.h: Don't declare execute_async.
	* save.c (run_commands): Use gnome_execute_async.
	(run_default_session): Likewise.
	* exec.c: Removed.

Thu May 14 09:49:08 1998  Tom Tromey  <tromey@cygnus.com>

	* save.c (run_default_session): Make icewm the default window
	manager.

	* save-session.c (main): Print error if couldn't connect to
	session manager.

	* manager.c (kill_client_connection): New function.
	(check_session_end): Correctly determine when last ordinary client
	finishes.  Send kill_client_connection message to each client,
	just to make sure.

Sun May  3 10:53:01 1998  Tom Tromey  <tromey@cygnus.com>

	* manager.c (io_error_handler): Call IceCloseConnection.

Thu Apr 30 23:13:53 1998  Tom Tromey  <tromey@cygnus.com>

	* save.c (run_default_session): Run `smproxy'.

	* prop.c (find_string_property): Put trailing \0 on result
	string.
	(find_vector_property): Likewise.

Sun Apr 26 16:19:31 1998  Tom Tromey  <tromey@cygnus.com>

	* save.c (run_default_session): If WINDOW_MANAGER defined, then
	launch it.

Wed Mar 18 22:26:54 1998  Tom Tromey  <tromey@cygnus.com>

	* save.c (run_default_session): Put `gmc' into the default
	session.

Mon Mar 16 00:52:21 1998  Tom Tromey  <tromey@cygnus.com>

	* main.c (ignore): Use sigemptyset to initialize sa_mask member.

	* save-session.c (main): Removed local "zap" variable.

	* main.c (ignore): New function.
	(main): Ignore SIGPIPE.

Tue Mar 10 21:40:28 1998  Tom Tromey  <tromey@cygnus.com>

	* save.c (run_commands): Pass saved directory information to
	execute_async().
	* exec.c (execute_async): Added `dir' argument.

Sun Mar  8 18:36:38 1998  Tom Tromey  <tromey@cygnus.com>

	* save.c (run_commands): `def' now a gboolean.
	(read_session): Likewise.
	(delete_session): Likewise.

	* Makefile.am (INCLUDES): Added GNOME_INCLUDEDIR.  Define
	GNOMELOCALEDIR.

Sat Mar  7 11:45:07 1998  Tom Tromey  <tromey@cygnus.com>

	* save-session.c (options): New structure.
	(parser): Likewise.
	(usage): Removed.
	(zap): New global.
	(parse_an_arg): New function.
	(main): Use new argument parsing and client-handling functions.
	* Makefile.am (gnome_session_SOURCES): Removed testbed.c, added
	main.c.
	* testbed.c: Removed.
	* main.c: New file.

Thu Feb 26 02:26:51 1998  Tom Tromey  <tromey@cygnus.com>

	* exec.c (errno): Declare if not a macro.

	* Makefile.am (bin_PROGRAMS): Only define if session support
	available.

	* Makefile.am (bin_PROGRAMS): Added save-session.
	(save_session_SOURCES): New macro.
	* save-session.c: New file.

	* testbed.c (main): Don't call gtk_init.

	* exec.c (execute_async): "pid" is a pid_t, not an int.  Close
	read end of pipe in child; mark write end as close-on-exec.

	* save.c (run_default_session): Run gnome-help-browser.

Mon Feb 23 00:49:05 1998  Tom Tromey  <tromey@cygnus.com>

	* save.c (run_default_session): NULL-terminate argv.
	* exec.c (report_errno): New function.
	(execute_async): Use it.

1998-02-19  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* testbed.c (main): Added app_id "gsm-testbed".

Mon Feb 16 00:04:09 1998  Tom Tromey  <tromey@cygnus.com>

	* exec.c (execute_async): Wait for child process.

	* save.c (run_default_session): New function.
	(read_session): If no saved session, and trying to load the
	default, then call run_default_session.

	* manager.c (check_session_end): Call gtk_main_quit if shutting
	down.

	* manager.h (execute_func): Removed.
	* save.c (run_commands): Removed executor argument.

	* manager.c (check_session_end): Save anyway_list first.

	* save.c (write_one_client): If restart style is RestartNever,
	don't bother saving client.
	(write_session): Added list2 argument.

	* manager.c (anyway_list): New global.
	(free_client): Do nothing if client is NULL.
	(close_connection): Take restart hints into account.
	(check_session_end): Pass anyway_list to write_session.

	* save.c: Include <gtk/gtk.h>.

Mon Feb 16 11:15:43 KST 1998  Changwoo Ryu  <cwryu@adam.kaist.ac.kr>

	* save.c: Include <config.h>.
	Replace "gnome-session.h" with "gnome-client.h".

Sat Feb 14 01:45:26 1998  Tom Tromey  <tromey@cygnus.com>

	* exec.c (execute_once): Removed.
	* manager.h (execute_once): Removed decl.
	* save.c (properties): Removed GNOME_SM_INIT_COMMAND.
	(read_session): Don't run initialization commands.

	* Makefile.am (LDADD): Don't include LEXLIB or DL_LIB.  Do include
	INTLLIBS.

Mon Feb  9 13:24:01 1998  Tom Tromey  <tromey@cygnus.com>

	* save.c (write_session): gnome -> session.
	(run_commands): Likewise.
	(read_session): Likewise.
	(delete_session): Likewise.
	* Makefile.am (bin_PROGRAMS): Changed name to gnome-session.
	(gnome_session_SOURCES): Likewise.

Tue Feb  3 00:38:40 1998  Tom Tromey  <tromey@cygnus.com>

	* save.c (write_session): gsm->gnome.
	(run_commands): Likewise.
	(read_session): Likewise.
	(delete_session): Likewise.

	* exec.c (execute_async): Wrote.

	* Makefile.am (bin_PROGRAMS): Program named "gnome".
	(gnome_SOURCES): Renamed.

	* save.c (delete_session): Call gnome_config_sync().

Mon Feb  2 23:08:50 1998  Tom Tromey  <tromey@cygnus.com>

	* save.c (write_one_client): Use gnome_config_set_vector.
	(write_session): Use prefix that doesn't result in new sub-keys.
	(read_session): Use new prefix.
	(run_commands): Likewise.  Use gnome_config_get_vector_with_default.

Thu Jan 29 16:49:12 EST 1998 Nathan Bryant <bryant@cs.usm.maine.edu>

	* Makefile.am: add DL_LIB.

Wed Jan 21 00:41:27 1998  Federico Mena <federico@bananoid.nuclecu.unam.mx>

	* gsm.c (gsm_generate_session_list): Replace snprintf with
	g_snprintf.

Tue Jan 20 18:43:50 1998  Tom Tromey  <tromey@cygnus.com>

	* gsm.h, gsm.c, gsm-backend.c: Removed.

Sun Jan 18 15:28:06 1998  Tom Tromey  <tromey@cygnus.com>

	* manager.c (check_session_end): New function.
	(save_yourself_done): Use it.
	(close_connection): Likewise.

	* manager.c: Include <string.h>.
	* ice.c: Include <config.h>.

	* testbed.c (main): Read session.

Fri Jan 16 23:50:48 1998  Tom Tromey  <tromey@cygnus.com>

	* ice.c (initialize_ice): Use Gnome's version number.

Sun Jan  4 13:24:47 1998  Tom Tromey  <tromey@cygnus.com>

	* save.c (read_session): Changed return value.  Started
	implementation.
	(run_commands): New function.
	(delete_session): Use it.

	* manager.c (add_zombie): New function.
	* manager.h (add_zombie): Declare.

	* Makefile.am (gsm_SOURCES): Include exec.c.
	* exec.c: New file.
	* manager.h (execute_async): Declare.

	* save.c (write_one_client): Added `number' argument; changed
	return value; changed how information represented in file.
	(prefix): No longer global.
	(write_session): Changed how information represented in file.
	(delete_session): Wrote.

Fri Jan  2 00:11:49 1998  Tom Tromey  <tromey@cygnus.com>

	* manager.c (save_yourself_done): Move save_finished_list to
	live_list when done.

Thu Jan  1 15:53:26 1998  Tom Tromey  <tromey@cygnus.com>

	* manager.h: Declare delete_session.
	* manager.c (save_yourself_done): Call write_session.
	* save.c (set_session_name): Made name argument const.
	(read_session): Likewise.
	(write_session): Made list argument const.
	(propsave): New type.
	(properties): New array.
	(NUM_PROPERTIES): New macro.
	(write_one_client): New function.
	(write_session): Wrote.
	(delete_session): New function.

	* prop.c (find_property_by_name): Made client argument const.
	(find_card8_property): Likewise.
	(find_string_property): Likewise.
	(find_vector_property): Likewise.

Sat Dec 27 12:39:40 1997  Tom Tromey  <tromey@cygnus.com>

	* save.c: New file.
	* prop.c: New file.
	* Makefile.am (gsm_SOURCES): Include prop.c, save.c.

	* manager.h: Declare find_property_by_name, find_card8_property,
	find_string_property, find_vector_property.

	* manager.c (save_helper): Removed.
	(x_save_type, x_interact_style, x_fast): Removed.
	(save_session): Traverse list by hand.
	(find_property_by_name): Moved to prop.c; exported.

Fri Dec 26 00:00:42 1997  Tom Tromey  <tromey@cygnus.com>

	* manager.c (find_client_by_connection): New function.
	(io_error_handler): New function.
	* manager.h: Declare io_error_handler.
	* ice.c (initialize_ice): Install IO error handler.

	* manager.c (close_connection): Remove client from all lists.
	Free client structure.

	* auth.c (write_iceauth): Make sure data is in range for fprintf.

	* Makefile: Removed.
	* Makefile.am: New file.
	* testbed.c: New file.

Thu Dec 25 00:12:44 1997  Tom Tromey  <tromey@cygnus.com>

	* ice.c (accept_connection): Must wait for ICE connection to leave
	pending state.

Wed Dec 24 23:33:09 1997  Tom Tromey  <tromey@cygnus.com>

	* auth.c, auth.h: Modified files from X11R6.3 `xsm' program.
	* TODO, manager.c, manager.h, ice.c: New files.

