#!/bin/sh

if [ "x$XDG_SESSION_TYPE" = "xwayland" ] &&
   [ "x$XDG_SESSION_CLASS" != "xgreeter" ] &&
   [  -n "$SHELL" ] &&
   grep -q "$SHELL" /etc/shells &&
   ! (echo "$SHELL" | grep -q "false") &&
   ! (echo "$SHELL" | grep -q "nologin"); then
  if [ "$1" != '-l' ]; then
    exec bash -c "exec -l '$SHELL' -c '$0 -l $*'"
  else
    shift
  fi
fi

SETTING=$(G_MESSAGES_DEBUG= gsettings get org.gnome.system.locale region)
REGION=${SETTING#\'}
REGION=${REGION%\'}

if [ -n "$REGION" ]; then
  if [ -z "$LC_CTYPE" -a -z "$LC_NUMERIC" -a -z "$LC_TIME" -a -z "$LC_COLLATE" \
       -a -z "$LC_MONETARY" -a -z "$LC_MESSAGES" -a -z "$LC_PAPER" \
       -a -z "$LC_NAME" -a -z "$LC_ADDRESS" -a -z "$LC_TELEPHONE" \
       -a -z "$LC_MEASUREMENT" -a -z "$LC_IDENTIFICATION" -a -z "$LC_ALL" \
     ] ; then
    export LANG=$REGION
  else
    export LC_TIME=$REGION
    export LC_NUMERIC=$REGION
    export LC_MONETARY=$REGION
    export LC_MEASUREMENT=$REGION
    export LC_PAPER=$REGION
  fi
fi

exec @libexecdir@/gnome-session-binary "$@"
