2008-05-25  Lucas Rocha  <lucasr@gnome.org>

	Add support for drag and drop of desktop files on Session Properties
	capplet. #437206, Vincent Untz. Patch from Jared Moore <jaredm@gmx.com>

	* capplet/commands.c (spc_command_add_app): check if icon is set
	on iter before using default app icon.
	* capplet/ui.c 
	(setup_treeview, drag_data_cb, add_from_desktop_file): set drag and 
	drop handlers. The treeview now can receive a list of desktop file uris 
	from DnD. 

2008-05-25  Lucas Rocha  <lucasr@gnome.org>

	Fix gnome-keyring-wrapper program to correctly set SSH_AUTH_SOCK env
	variable on session initialization phase. #534055, Dan Winship.

	* compat/gnome-keyring-daemon-wrapper.c (keyring_daemon_start):
	capture output from gnome-keyring-daemon and set SSH_AUTH_SOCK and
	GNOME_KEYRING_PID env variables properly.  

2008-05-25  Lucas Rocha  <lucasr@gnome.org>

	Make splash listen to "SessionRunning" to know when to go away on 
	session startup. #529602, Karsten Bräckelmann.

	* splash/Makefile.am: add D-Bus bits on INCLUDES and LDADD.
	* splash/README: remove obsolete note about gnome-session-splash.
	* splash/gnome-session-splash.c (get_session_bus,
	set_session_running_handler, on_session_running, main): listen to
	"SessionRunning" D-Bus signal to know when go away.
	* splash/gnome-session-splash.desktop.in: move splash to Panel phase
	as it's the phase just after window manager is started.

2008-05-25  Lucas Rocha  <lucasr@gnome.org>

	Emit "SessionRunning" D-Bus signal when session is fully up and
	running with all autostart apps present.

	* gnome-session/dbus.[ch]
	(gsm_dbus_server_class_init): add "session-running" signal to 
	GsmDBusServer class.
	(gsm_dbus_emit_session_running): new method for emitting the new signal.
	* gnome-session/org.gnome.SessionManagement.xml: added "SessionRunning"
	signal.
	(gsm_dbus_emit_session_over): rename gsm_dbus_session_over to
	gsm_dbus_emit_session_over for consistency.
	* gnome-session/session.c (end_phase): added
	gsm_dbus_emit_session_emit() call when GSM_SESSION_PHASE_RUNNING is
	reached.

2008-05-24  Lucas Rocha  <lucasr@gnome.org>

	Emit "SessionOver" D-Bus signal before ending the session.

	* gnome-session/dbus.[ch]
	(gsm_dbus_server_class_init): add "session-over" signal to 
	GsmDBusServer class.
	(gsm_dbus_session_over): new method for emitting the new signal.
	* gnome-session/org.gnome.SessionManagement.xml: added "SessionOver"
	signal.
	* gnome-session/session.c (session_shutdown): added
	gsm_dbus_session_over() call.

2008-05-17  Lucas Rocha  <lucasr@gnome.org>

	* gnome-session/logout-dialog.c: fixes small build warning.

2008-05-17  Lucas Rocha  <lucasr@gnome.org>

	* gnome-session/main.c 
	(main): call gsm_dbus_shutdown, gsm_xsmp_shutdown, and
	gsm_gconf_shutdown after main quit.
	(gsm_initialization_error): call gtk_main_quit after showing error
	dialog.

2008-05-17  Lucas Rocha  <lucasr@gnome.org>

	Port gnome-session-save tool to new code base.

	* tools/gnome-session-save.c: tool source code.
	* configure.in, Makefile.am, tools/Makefile.am: add tools to build.
	* gnome-session/org.gnome.SessionManagement.xml, 
	gnome-session/dbus.c (gsm_dbus_server_set_name): new SetName D-Bus
	method which should be used to set the name of current session.
	* gnome-session/session.[ch] (gsm_session_set_name): new GsmSession
	method for setting session name.

2008-05-14  Lucas Rocha  <lucasr@gnome.org>

	* configure.in: post-release bump to 2.23.3

2008-05-14  Lucas Rocha  <lucasr@gnome.org>

	* NEWS:
	* README: Version 2.23.2.2.

2008-05-14  Lucas Rocha  <lucasr@gnome.org>

	* capplet/ui.c (add_app_cb): remove iter from store if app is not
	actually added. #532973,  David Ronis.

2008-05-14  Lucas Rocha  <lucasr@gnome.org>

	* gnome-session/main.c (main): fixed a build warning on the
	gtk_init_with_args() call.

2008-05-14  Lucas Rocha  <lucasr@gnome.org>

	* capplet/ui.c: fixed command entry widget name to match the one
	in the glade.

2008-05-14  Kjartan Maraas  <kmaraas@gnome.org>

	* data/session-properties.glade: Don't translate
	widget labels.

2008-05-13  Lucas Rocha  <lucasr@gnome.org>

	* configure.in: post-release bump to 2.23.3

2008-05-13  Lucas Rocha  <lucasr@gnome.org>

	* NEWS:
	* README: Version 2.23.2.1.

2008-05-13  Lucas Rocha  <lucasr@gnome.org>

	* configure.in: fixed libglade dependency to 2.3.6. 
	#532835, Karsten Bräckelmann.

2008-05-12  Lucas Rocha  <lucasr@gnome.org>

	* configure.in: post-release bump to 2.23.3

2008-05-12  Lucas Rocha  <lucasr@gnome.org>

	* NEWS:
	* README: Version 2.23.2.

2008-05-12  Lucas Rocha  <lucasr@gnome.org>

	* capplet/main.c, capplet/ui.[ch], capplet/commands.[ch]: added
	copyright headers.

2008-05-10  Lucas Rocha  <lucasr@gnome.org>

	Session properties capplet re-implemented for new code base.
	#529601, Karsten Bräckelmann.

	* capplet/main.c, capplet/ui.[ch], capplet/commands.[ch]: session
	properties capplet code.
	* gnome-session/util.[ch]: utility functions shared among session
	manager and capplet.
	* gnome-session/session.c (gsm_session_new): use gsm_util_* functions
	instead of local ones.
	* data/session-properties.glade: capplet Glade file.

2008-04-22  Lucas Rocha  <lucasr@gnome.org>

	* configure.in: post-release bump to 2.23.2

2008-04-22  Lucas Rocha  <lucasr@gnome.org>

	* NEWS:
	* README: Version 2.23.1.1.

2008-04-22  Lucas Rocha  <lucasr@gnome.org>

	* splash/Makefile.am: install splash .desktop files in an autostart
	directory instead of old default-session one. 
	* compat/Makefile.am: install compat .desktop files in an autostart
	directory instead of old default-session one. 

2008-04-21  Lucas Rocha  <lucasr@gnome.org>

	* configure.in: post-release bump to 2.23.2

==================== 2.23.1 ====================

2008-04-21  Lucas Rocha  <lucasr@gnome.org>

	* NEWS:
	* README: Version 2.23.1.

2008-04-21  Lucas Rocha  <lucasr@gnome.org>

	* data/Makefile.am, data/nautilus.desktop,
	data/gnome-settings-daemon.desktop: don't install .desktop files for
	nautilus and gnome-settings-daemon because gnome-session looks for
	those in their origin paths now.

2008-04-21  Lucas Rocha  <lucasr@gnome.org>

	* data/gnome-wm: restore the gnome-wm script to keep backwards
	compatibitility.

2008-04-19  Lucas Rocha  <lucasr@gnome.org>

	* gnome-session/app-autostart (file_condition_cb, is_disabled):
	Separate callbacks for if-exists and unless-exists condition
	to not need a condition_type private attribute.

2008-04-13  Lucas Rocha  <lucasr@gnome.org>

	Fully implement if-exists and unless-exists condition types.

	* configure.in: bump glib dependency to 2.16.0 and add gio bits.
	* gnome-session/app-autostart.c: added condition and condition_type
	private attribute to keep track of codition changes in the app.
	(gsm_app_autostart_class_init, gsm_app_autostart_dispose): added 
	dispose to free internal resources.
	(file_condition_cb): callback for file monitor used to keep track
	of if-exists and unless-exists condition changes.
	(gconf_condition_cb): only emit "condition-changed" if the condition
	actually changed.
	(is_disabled): added file monitors for if-exists and unless-exists
	condition types.

2008-04-10  Lucas Rocha  <lucasr@gnome.org>

	* data/gnome-panel.desktop, data/Makefile.am: don't install
	gnome-panel.desktop anymore as gnome-panel has all needed keys
	in its .desktop file now.

2008-04-10  Lucas Rocha  <lucasr@gnome.org>

	Re-implemented the way we define the default session. Instead of a
	directory full of .desktop files, we now get the list of default apps
	from a gconf key. Then session manager then looks for those apps in
	the standard applications and autostart directories. This way we don't
	require default apps to export their .desktop files in a special
	directory. #525157, Rob Bradford.

	* data/gnome-session.schemas.in: added a new gconf key
	/desktop/gnome/session/default-session which stores the list of
	default session apps.
	* gnome-session/Makefile.am: no need to define default-session
	directory anymore.
	* gnome-session/gsm.h: added new constant called
	GSM_GCONF_DEFAULT_SESSION_KEY refering to new gconf key.
	* gnome-session/session.c 
	(gsm_session_new, append_default_apps): new function to load default 
	apps from gconf key. The gconf key only stores the application names 
	and GsmSession looks for a respective .desktop file in some standard 
	application and autostart directories.
	(get_autostart_dirs, get_app_dirs): new utility functions which return
	all autostart and applications directories respectively.

2008-04-10  Lucas Rocha  <lucasr@gnome.org>

	* gnome-session/README: fix small typo.

2008-04-10  Lucas Rocha  <lucasr@gnome.org>

	* gnome-session/Makefile.am: use GNOME_SESSION_FLAGS and
	GNOME_SESSION_LIBS in INCLUDES and LDADD respectively. 

2008-04-10  Lucas Rocha  <lucasr@gnome.org>

	* gnome-session/main.c (main): correctly set translation domain on
	gtk_init_with_args() call.

2008-04-10  Lucas Rocha  <lucasr@gnome.org>

	* configure.in: several cosmetic changes.

2008-04-10  Lucas Rocha  <lucasr@gnome.org>

	* gnome-session/main.c (main), gnome-session/Makefile.am: uncommented
	gettext-related code. Defined locale directory.

2008-04-09  Lucas Rocha  <lucasr@gnome.org>

	* HACKING: removed obsolete information and updated the content.

2008-03-31  Lucas Rocha  <lucasr@gnome.org>

	* gnome-session/app-autostart.c (is_disabled): Call
	egg_desktop_file_can_launch() to check OnlyShowIn/NotShowIn and
	TryExec. #525184, Owen Taylor. Patch by Dan Winship.

2008-03-31  Lucas Rocha  <lucasr@gnome.org>

	* data/default-session.in: removed default-session.in as this is 
	not necessary or used by gnome-session anymore.

2008-03-30  Lucas Rocha  <lucasr@gnome.org>

	* data/metacity.desktop, data/Makefile.am: don't install
	metacity.desktop anymore as metacity is doing it now.

2008-03-23  Lucas Rocha  <lucasr@gnome.org>

	* AUTHORS, MAINTAINERS: updated with real content.

2008-03-23  Lucas Rocha  <lucasr@gnome.org>

	Fix relation between apps set with X-GNOME-Autorestart and
	AutostartCondition. 

	* gnome-session/session.c 
	(app_condition_changed, client_disconnected): don't restart apps if
	their condition are set to false.
	* gnome-session/app-autostart.c (is_disabled): don't keep track of
	condition in case the app is not set with X-GNOME-Autorestart.

2008-03-22  Lucas Rocha  <lucasr@gnome.org>

	* configure.in: removed libnotify dependency and made some cleanups. 

2008-03-22  Lucas Rocha  <lucasr@gnome.org>

	* configure.in: update version to 2.23.1 for future release.
	* po/POTFILES.in, data/Makefile.am: Several fixes in the build files 
	in order to make it pass distcheck.

2008-03-06  Lucas Rocha  <lucasr@gnome.org>

	* egg/eggdesktopfile.c (egg_desktop_file_new_from_key_file),
	gnome-session/xsmp.c (gsm_xsmp_init): fixed two memory leaks. 

2008-03-05  Lucas Rocha  <lucasr@gnome.org>

	* egg/eggdesktopfile.c (egg_desktop_file_launchv): use g_ptr_array_add
	instead of g_ptr_array_set_size to add NULL item to env array.

2008-03-05  Lucas Rocha  <lucasr@gnome.org>

	* egg/eggdesktopfile.c (egg_desktop_file_launchv): add a NULL item to
	the environment vars array in order to avoid invalid memory access.

2008-03-05  Lucas Rocha  <lucasr@gnome.org>

	* gnome-session/client-xsmp.c (debug_print_property): removed useless
	debug message.

2008-03-04  Lucas Rocha  <lucasr@gnome.org>

	Added support for stopping/starting autostart apps based on their
	AutostartCondition key definition (GConf-only for now).

	* gnome-session/app-autostart.[ch]: added condition-changed signal and
	keep track of gconf key changes from the .desktop AutostartCondition
	key.
	* gnome-session/session.c (start_phase): connect to condition-changed 
	signal and launch or kill autostart app depending on the new condition 
	state.

2008-02-19  Lucas Rocha  <lucasr@gnome.org>

	* gnome-session/Makefile.am: added app-resumed.[ch] to the build.
	* gnome-session/app-resumed.[ch]: fix attribute name. 
	* gnome-session/session.c (gsm_session_new, 
	append_saved_session_apps): uncomment legacy saved session loading 
	code.

2008-02-19  Lucas Rocha  <lucasr@gnome.org>

	* data/Makefile.am: added autotools bits for session .desktop file.
	* data/gnome.desktop.in: added xsession .desktop file.

2008-02-19  Lucas Rocha  <lucasr@gnome.org>

	* data/Makefile.am: added autotools bits for GConf schemas.
	* gnome-session/gsm.schemas: moved schemas file to "data" directory as
	gnome-session.schemas.in.

2007-11-27  Lucas Rocha  <lucasr@gnome.org>

	* gnome-session/dbus.c (gsm_dbus_init): use G_SPAWN_SEARCH_PATH flag
	and do not use '--sh-syntax' option on dbus-launch in order to have it
	correctly running and setting the respective environment vars.

2007-11-26  Lucas Rocha  <lucasr@gnome.org>

	New D-Bus APIs for logging out (org.gnome.SessionManager.Logout) 
	and shutting down the computer (org.gnome.SessionManager.Shutdown).

	* gnome-session/Makefile.am: added gdm.[ch], power-manager.[ch] 
	and logout-dialog.[ch] to the build.
	* gnome-session/logout-dialog.[ch]: new logout dialog implementation 
	for logout and shutdown operations. 
	* gnome-session/power-manager.[ch]: new functions for powering down, 
	restarting, and suspending the computer through GNOME Power Manager.
	* gnome-session/gdm.[ch]: new functions for communication with GDM.
	* gnome-session/client-xsmp.c: (save_yourself_request_callback): update
	with new gnome_session_initiate_shutdown() API.
	* gnome-session/dbus.c (gsm_dbus_server_logout,
	gsm_dbus_server_shutdown), gnome-session/org.gnome.SessionManagement.xml: 
	new D-Bus APIs for Logout and Shutdown.
	* gnome-session/session.[ch]: 
	(logout_dialog_response, gsm_session_initiate_shutdown): new parameter 
	for determining which logout mode to use (normal logout or shutdown). Use 
	new logout dialog when a confirmation is requested. 
	(session_cancel_shutdown): reset the logout dialog response in case the
	shutdown process is cancelled.
	(initiate_shutdown): moved the code for initiating the session shutdown
	to a separate function.
	(session_shutdown): activate shutdown functions in case this is
	requested in the logout dialog.  

2007-11-20  Lucas Rocha  <lucasr@gnome.org>

	* gnome-session/session.c (app_registered): remove timeout function
	when all applications from a certain phase are registered on time.

2007-11-18  Lucas Rocha  <lucasr@gnome.org>

	* compat/gnome-settings-daemon-helper.c: remove screen resolution
	settings code as this is now handled by gnome-settings-daemon
	accordingly. See bug #434982. 
	* configure.in: don't check XRandr bits anymore.

2007-11-17  Dan Winship  <danw@gnome.org>

	* gnome-session/xsmp.c: 
	* gnome-session/client-xsmp.c: 
	* gnome-session/app-resumed.c: add some comments explaining
	various things

2007-11-12  Lucas Rocha  <lucasr@gnome.org>

	* gnome-session/session.c (start_phase): only add autostarted apps
	to pending apps on phases before GSM_SESSION_PHASE_APPLICATION.

2007-11-10  Lucas Rocha  <lucasr@gnome.org>

	Add support for client autorestart which can be activated by the
	"X-GNOME-AutoRestart" .desktop file key or by setting the restart
	style accordingly through the session client API (GnomeClient's 
	gnome_client_set_restart_style()).

	* gnome-session/client-xsmp.c 
	(register_client_callback): do not generate new IDs itself, and have it just pass 
	the previous_id directly to gsm_session_register_client(), and if it's NULL, then
	gsm_session_register_client() can generate the new client ID using
	gsm_xsmp_generate_client_id().
	(gsm_client_xsmp_class_init, xsmp_restart): XSMP client implementation
	of gsm_client_restart() method.
	* gnome-session/client.[ch] (gsm_client_restart): new abstract method
	for restarting a session client.
	* gnome-session/session.c (gsm_session_register_client): change it to
	generate a new client ID in case the provided ID is NULL and return the
	generated ID in case the client is accepted. A client ID is accepted
	by the session manager if it's not duplicated, belongs to one of the
	autostarted apps or is NULL. 

2007-11-07  Lucas Rocha  <lucasr@gnome.org>

	* egg/eggdesktopfile.c (egg_desktop_file_launchv): fix build warning.

2007-10-27  Lucas Rocha  <lucasr@gnome.org>

	* gnome-session/client-xsmp.c (xsmp_get_client_id, xsmp_get_pid,
	xsmp_get_restart_command, xsmp_get_autorestart): cast correct variable
	in order to make invalid memory accesses on wrong variable.

2007-10-27  Lucas Rocha  <lucasr@gnome.org>

	* gnome-session/client.c (gsm_client_get_client_id,
	gsm_client_get_pid, gsm_client_get_desktop_file,
	gsm_client_get_restart_command, gsm_client_get_discard_command,
	gsm_client_get_autorestart, gsm_client_save_state): add definition for
	abstract methods in GsmClient.

2007-10-23  Lucas Rocha  <lucasr@gnome.org>

	* gnome-session/gconf.c (unset_display_setup): revert change for
	unsetting DISPLAY environment variable before running
	gconf-sanity-check as now it can run without a display.

2007-10-21  Lucas Rocha  <lucasr@gnome.org>

	* gnome-session/session.c 
	(start_phase): correctly check if application was successfully
	launched. Fix crasher when printing out error message in case application 
	failed to launch and returned no error.
	(gsm_session_register_client): emit "registered" signal on application
	with the registered session client id.

2007-10-21  Lucas Rocha  <lucasr@gnome.org>

	* gnome-session/app.[ch] 
	(gsm_app_class_init): added new GsmApp signals "registered" and "exited".
	(launch, app_exited): if case the application belongs to
	Initialization phase, monitor program exit in order to emit "exited"
	signal accordingly. 
	(gsm_app_registered): new method for emitting "registered" signal on
	an GsmApp object.

2007-10-21  Lucas Rocha  <lucasr@gnome.org>

	* gnome-session/gconf.c (unset_display_setup): do not unset DISPLAY
	environment variable as gconf-sanity-check doesn't run if there's no
	defined display.

2007-10-21  Lucas Rocha  <lucasr@gnome.org>

	* egg/eggsmclient.c (sm_client_post_parse_func): try to get session
	client id from the DESKTOP_AUTOSTART_ID environment variable in case
	no client id is given from command line option --sm-client-id. Unset
	this environment variable just after using it in order to avoid child
	processes to use the same client id.

2007-10-21  Lucas Rocha  <lucasr@gnome.org>

	* egg/eggdesktopfile.c (egg_desktop_file_launchv): fix leak and
	invalid memory access on environment variables array.

2007-10-21  Lucas Rocha  <lucasr@gnome.org>

	* compat/gnome-keyring-daemon-wrapper.desktop.in,
	compat/gnome-settings-daemon-helper.desktop.in,
	data/gnome-panel.desktop, data/gnome-settings-daemon.desktop,
	data/metacity.desktop, data/nautilus.desktop,
	splash/gnome-login-sound.desktop.in,
	splash/gnome-session-splash.desktop.in: use 
	X-GNOME-Autostart-Notify key for passing session client ids
	through the DESKTOP_AUTOSTART_ID environment variable.

2007-06-29  Dan Winship  <danw@gnome.org>

	* Initial commit. Don't expect it to be useful yet. :)
